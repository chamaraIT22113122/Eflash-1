class a{constructor(){this.API_BASE="https://adorable-dodol-77eb48.netlify.app/api"}async getAllProducts(){try{const t=await fetch(`${this.API_BASE}/products`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()||[]}catch(t){return console.error("Error fetching products:",t),this.getFallbackProducts()}}async addProduct(t){try{const r={...t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},e=await fetch(`${this.API_BASE}/products`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok)throw new Error(`HTTP ${e.status}`);const o=await e.json();return window.dispatchEvent(new CustomEvent("productsUpdate")),o}catch(r){return console.error("Error adding product:",r),this.addFallbackProduct(t)}}async updateProduct(t,r){try{const e={...r,updatedAt:new Date().toISOString()},o=await fetch(`${this.API_BASE}/products/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok)throw new Error(`HTTP ${o.status}`);const n=await o.json();return window.dispatchEvent(new CustomEvent("productsUpdate")),n}catch(e){return console.error("Error updating product:",e),this.updateFallbackProduct(t,r)}}async deleteProduct(t){try{const r=await fetch(`${this.API_BASE}/products/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP ${r.status}`);const e=await r.json();return window.dispatchEvent(new CustomEvent("productsUpdate")),e}catch(r){return console.error("Error deleting product:",r),this.deleteFallbackProduct(t)}}getFallbackProducts(){try{const t=localStorage.getItem("eflash_admin_products");return t?JSON.parse(t):[]}catch{return[]}}addFallbackProduct(t){try{const r=this.getFallbackProducts(),e={...t,id:Date.now().toString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return r.unshift(e),localStorage.setItem("eflash_admin_products",JSON.stringify(r)),window.dispatchEvent(new CustomEvent("productsUpdate")),e}catch{return null}}updateFallbackProduct(t,r){try{const e=this.getFallbackProducts(),o=e.findIndex(n=>n.id===t||n._id===t);if(o===-1)throw new Error("Not found");return e[o]={...e[o],...r,updatedAt:new Date().toISOString()},localStorage.setItem("eflash_admin_products",JSON.stringify(e)),window.dispatchEvent(new CustomEvent("productsUpdate")),e[o]}catch{return null}}deleteFallbackProduct(t){try{const e=this.getFallbackProducts().filter(o=>o.id!==t&&o._id!==t);return localStorage.setItem("eflash_admin_products",JSON.stringify(e)),window.dispatchEvent(new CustomEvent("productsUpdate")),{message:"Deleted successfully"}}catch{return null}}}const c=new a;export{c as p};
